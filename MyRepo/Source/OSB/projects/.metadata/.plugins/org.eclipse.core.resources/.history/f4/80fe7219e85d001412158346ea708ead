package com.xrx.java.dao;

import java.sql.CallableStatement;
import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.ResultSetMetaData;
import java.sql.SQLException;
import java.util.ListIterator;

import com.acs.benefits.access.beans.CallableArg;
import com.acs.benefits.access.beans.Inputs;
import com.acs.benefits.access.util.*;

public class SybaseJConnTestClient {

	Connection conn = null;
	CallableStatement stmt = null;
	ResultSet rs = null;
	int rsnum = 0;
	String url = null;
	//ResultSetMetaData rsmd = null;

	public void getACSResults() {

		try {

			Class.forName("com.sybase.jdbc3.jdbc.SybDriver");
			url = "jdbc:sybase:Tds:10.203.29.15:3007/KLG_RKS_ACS";
			System.out.println("Connection URL :: " + url);
			java.sql.Connection conn = DriverManager.getConnection(url,
					"intranet1", "intranet1");
			System.out.println("Connection Object :: " + conn);

			stmt = conn.prepareCall("{call g_SavingsInSight_dc(?, ?, ?, ?)}");

			stmt.setString(1, "505");
			stmt.setString(2, "06");
			stmt.setString(3, "911290011");
			stmt.registerOutParameter(4, java.sql.Types.VARCHAR);

			boolean results = stmt.execute();

			System.out.println("ResultSet:: results : " + results);
			System.out.println("ResultSet:: getResultSet() : "
					+ stmt.getResultSet());
			// String strOutParamRes = stmt.getString(8);
			// stmt.getMoreResults();
			// int strOutParamRes = stmt.getInt(8);
			// System.out.println("OutParamResponse :: " + strOutParamRes);
			System.out.println("OutParamResponse :: " + stmt.getString(4));
			// System.out.println("ResultSet:: " + stmt.getResultSet());

			if (results) {
				System.out.println("ResultSet:: getResultSet() : "
						+ stmt.getResultSet());
				// ResultSet rs1 = stmt.getResultSet();
				// System.out.println("Inside IF ResultSet::: " + rs1);
			} else {
				// int cursorIndex = inputs.getCursorArg().getIndex();
				// System.out.println("ResultSet::: " + rs);
				// rs = (ResultSet) stmt.getObject(3);

			}

			// rsnum++;

			// System.out.println("ResultSet: " + rsnum);

		} catch (Exception e) {

			System.out.println("Exception occurred in getResults:");
			e.printStackTrace();
		} finally {
			try {
				if (stmt != null)
					stmt.close();
				if (conn != null)
					conn.close();
				if (rs != null)
					rs.close();
			} catch (SQLException e) {
			}
		}
	}

	public void getBEFResults() {

		try {

			//Class.forName("com.sybase.jdbc3.jdbc.SybDriver");
			//url = "jdbc:sybase:Tds:10.203.29.15:3001/KLG_RKS_BEF";
			
			  Class.forName("net.sourceforge.jtds.jdbc.Driver");
		      //  url = "jdbc:jtds:sybase://sybasehost:4100/dbname";
		        url = "jdbc:jtds:sybase://10.203.29.15:3001/KLG_RKS_BEF";
			
			
			System.out.println("Connection URL :: " + url);
			java.sql.Connection conn = DriverManager.getConnection(url,
					"intranet1", "intranet1");
			System.out.println("Connection Object :: " + conn);

			stmt = conn.prepareCall("{call g_RightOpt(?, ?, ?, ?, ?, ?)}");

			stmt.setString(1, "137");
			stmt.setString(2, "98");
			stmt.setString(3, "911440011");
			stmt.registerOutParameter(4, java.sql.Types.VARCHAR);
			stmt.setString(5, "N");
			stmt.setString(6, null);

			boolean results = stmt.execute();

			System.out.println(" SP Trigger Status :: " + results);

			//System.out.println("OutParamResponse :: " + stmt.getString(4));
			//System.out.println("ResultSet Object:: " + stmt.getResultSet());
			//System.out.println("ResultSet MetaData:: " + rs.getMetaData());

			// ResultSet rs = stmt.getResultSet();
			// ResultSetMetaData rsmd = rs.getMetaData();
			rs = stmt.getResultSet();
			ResultSetMetaData rsmd = rs.getMetaData();
			//Object value=stmt.getObject(4);
		//	System.out.println("Out Response :: " + value);
			
			//processOutputs();
			
			//rsmd = rs.getMetaData();
			int colCount = rsmd.getColumnCount();

			for (int col = 1; col <= colCount; col++) {

				// rsmd.getColumnLabel(col);
				System.out.println("ColumnLabel ::" + rsmd.getColumnLabel(col));
				// rsmd.getColumnTypeName(col);
				System.out.println("ColumnTypeName ::"
						+ rsmd.getColumnTypeName(col));
				// rsmd.getColumnType(col);
				System.out.println("ColumnType ::" + rsmd.getColumnType(col));
				// String.valueOf(rsmd.getColumnDisplaySize(col));
				System.out.println("ColumnDisplaySize ::"
						+ String.valueOf(rsmd.getColumnDisplaySize(col)));
				

			}

			while (rs.next()) {

				for (int i = 1; i <= colCount; i++) {
					// String columnName = rsmd.getColumnName(i);
					String columnName = rsmd.getColumnLabel(i);					
				/*	String columnName3 = rsmd.getColumnTypeName(i);
					int columnName2 = rsmd.getColumnType(i);
					int columnName4 = rsmd.getColumnDisplaySize(i);*/
					
					System.out.println("ColumnName ::" + columnName);
					
					Object value = rs.getObject(i);
					if (value != null)
						System.out.println(" ColumnValue ::" + value);

				}
			}

			// System.out.println("ResultSet: " + rsnum);

		} catch (Exception e) {

			System.out.println("Exception occurred in getResults:");
			e.printStackTrace();
		} finally {
			try {
				if (stmt != null)
					stmt.close();
				if (conn != null)
					conn.close();
				if (rs != null)
					rs.close();
			} catch (SQLException e) {
			}
		}
	}

	public void processOutputs() throws Exception {
		System.out.println("processOutputs Method :");
		Inputs inputs = new Inputs();
		CallableArg callableArg;
		
		System.out.println("processOutputs Method :" +String.valueOf(inputs.getOutputArgCount()));
		//String.valueOf(inputs.getOutputArgCount());		

		Object value;
		for (ListIterator i = inputs.getOutputArgs().listIterator(); i
				.hasNext();) {
			callableArg = (CallableArg) i.next();

			value = stmt.getObject(callableArg.getIndex());
			if (stmt.wasNull())
				value = null;

			System.out.println("name" + callableArg.getName());
			System.out.println("type"
					+ JDBCUtil.SQLTypeToString(callableArg.getJdbcType()));

		}
	}

	public static void main(String args[]) {

		SybaseJConnTestClient test = new SybaseJConnTestClient();
		// test.getACSResults();
		test.getBEFResults();
	}
}
